const path = require('node:path');
const pluginPath = path.join(__dirname, '..', '..', '..', 'vendor', 'prettier-babel-plugin.js');
const plugin = require(pluginPath);

function normalizeOptions(options = {}) {
  const normalized = { ...options };
  if (!normalized.sourceType) {
    normalized.sourceType = 'module';
  }
  if (!normalized.plugins) {
    normalized.plugins = [];
  }
  return normalized;
}

function parse(code, options = {}) {
  const normalized = normalizeOptions(options);
  // Prettier's Babel plugin expects a parser option to avoid recursion loops.
  const parserOptions = { ...normalized, parser: 'babel' };
  return plugin.parsers.babel.parse(code, parserOptions);
}

module.exports = { parse };
